"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"function"==typeof define&&define.amd?define([],t("lousyLoad")):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t("lousyLoad"):e.lousyLoad=t("lousyLoad")}(window,function(e){var t={immediate:!0,selector:"img",threshold:0,wrapElement:!0},n=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a]);return n};window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t){t=t||window;for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)});var i=function(){function e(t){_classCallCheck(this,e),this.__data={},this.__element=t}return _createClass(e,[{key:"data",value:function(e,t){return e?t?void(this.__data[e]=t):this.__data[e]:this.__data}},{key:"el",get:function(){return this.__element}}]),e}(),a=function(){function a(i,o){_classCallCheck(this,a),this.element=i,this._defaults=t,this._name=e,this.options=n(t,o),this.options.immediate&&this.init()}return _createClass(a,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.$images=this.element.querySelectorAll(this.options.selector),this.$images.forEach(this.prepareImage.bind(this)),e.isReinit||(window.onresize=this.__debounce(this.__resizeHandler.bind(this),50)),this.$images}},{key:"prepareImage",value:function(e){var t=new i(e),n=t.el,a=(Math.max(document.documentElement.clientHeight,window.innerHeight||0),this.__getImageDimensions(n)),o=null===n.getAttribute("data-nowrap")&&this.options.wrapElement,r=void 0;t.data("shouldWrap",o),o&&((r=document.createElement("span")).classList.add("ll-image_wrapper"),r.style.width=a.width+"px",r.style.height=a.height+"px",r.style.display="inline-block",n.classList.add("ll-image"),n.style.width=a.width+"px",n.style.height=a.height+"px",this.__wrapElement(r,n),t.data("wrapper",r));var s=this.tryLoadImage(t),l=this.__debounce(function(){this.tryLoadImage(t)&&window.removeEventListener("scroll",l)}.bind(this),50);return s||window.addEventListener("scroll",l),t}},{key:"tryLoadImage",value:function(e,t){var n=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=e.el,a=void 0;return!((t||i.getBoundingClientRect().top)>n+this.options.threshold)&&(a="IMG"!==i.nodeName?"background":i.getAttribute("data-srcset")?"srcset":"src",e.data("type",a),this.__loadImageByType(e,a),!0)}},{key:"__debounce",value:function(e,t,n){var i=void 0;return function(){var a=this,o=arguments,r=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(a,o)},t),r&&e.apply(a,o)}}},{key:"__wrapElement",value:function(e,t){t.length||(t=[t]);for(var n=t.length-1;n>=0;n--){var i=n>0?e.cloneNode(!0):e,a=t[n],o=a.parentNode,r=a.nextSibling;i.appendChild(a),r?o.insertBefore(i,r):o.appendChild(i)}}},{key:"__unwrapElement",value:function(e){for(var t=e.parentNode,n=t.parentNode;t.firstChild;)n.insertBefore(t.firstChild,t);n.removeChild(t)}},{key:"__getImageDimensions",value:function(e){var t=window.getComputedStyle(e),n="IMG"===e.nodeName?Number(e.getAttribute("width")):e.offsetWidth,i="IMG"===e.nodeName?Number(e.getAttribute("height")):e.offsetHeight,a="none"===t.getPropertyValue("max-width")?null:t.getPropertyValue("max-width"),o=n/i;if(a){if(a.indexOf("%")>-1){var r=Number(a.replace("%",""))/100,s=window.getComputedStyle(e.parentElement).getPropertyValue("width");a=Number(s.replace("px",""))*r}else a.indexOf("px")>-1&&(a=Number(a.replace("px","")));Number(n)>Number(a)&&(n=a,i=a/o)}else a=n;return{width:n,height:i,maxWidth:a,aspectRatio:o}}},{key:"__attachLoadEvent",value:function(e,t,n){function i(){a.classList.add("is-loaded"),n&&t.classList.add("is-loaded")}var a=e.el;if(t=t||e.data("wrapper"),n=n||e.data("shouldWrap"),"IMG"!==a.nodeName){var o=window.getComputedStyle(a).getPropertyValue("background-image").replace(/(?:^url\(["']?)|(?:["']?\))$/g,""),r=new Image;r.onload=i.bind(this),r.src=o,r.complete&&i()}else a.onload=i.bind(this)}},{key:"__loadImageByType",value:function(e,t){var n=e.el;switch(t){case"srcset":n.srcset=n.getAttribute("data-srcset"),n.src=n.getAttribute("data-src");break;case"background":this.options.backgroundClass?n.classList.remove(this.options.backgroundClass.replace(/^\./,"")):n.style.removeProperty("background");break;default:n.src=n.getAttribute("data-src")}this.__attachLoadEvent(e)}},{key:"__resizeHandler",value:function(){var e=this;this.$images.forEach(function(t){null===t.getAttribute("data-nowrap")&&e.options.wrapElement&&e.__unwrapElement(t)}),this.init({isReinit:!0})}}]),a}();if(window.jQuery){var o=window.jQuery;o.fn[e]=function(t){return t=t||{},this.each(function(){o.data(this,"plugin_"+e)||(t.element=this,o.data(this,"plugin_"+e,new a(this,t)))})}}return a});