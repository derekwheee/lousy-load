"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"function"==typeof define&&define.amd?define([],t("lousyLoad")):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t("lousyLoad"):e.lousyLoad=t("lousyLoad")}(window,function(e){var t={immediate:!0,selector:"img",threshold:100,wrapElement:!0},n=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a]);return n};window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t){t=t||window;for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)});var o=function(){function e(t){_classCallCheck(this,e),this.__data={},this.__element=t,console.log(this)}return _createClass(e,[{key:"data",value:function(e,t){return e?t?void(this.__data[e]=t):this.__data[e]:this.__data}},{key:"el",get:function(){return this.__element}}]),e}(),a=function(){function a(o,i){_classCallCheck(this,a),this.element=o,this._defaults=t,this._name=e,this.options=n(t,i),this.options.immediate&&this.init()}return _createClass(a,[{key:"init",value:function(){var e=this.element.querySelectorAll(this.options.selector);return e.forEach(this.prepareImage.bind(this)),e}},{key:"prepareImage",value:function(e){var t=new o(e);console.log(t),console.log(t.data),console.log(t instanceof Element);var n=Math.max(document.documentElement.clientHeight,window.innerHeight||0),a=this.__getImageDimensions(t),i=null===t.getAttribute("data-nowrap")&&this.options.wrapElement,r=void 0;t.data("shouldWrap",i),i&&((r=document.createElement("span")).classList.add("ll-image_wrapper"),r.style.width=a.width+"px",r.style.height=a.height+"px",r.style.display="inline-block",t.classList.add("ll-image"),t.style.width=a.width+"px",t.style.height=a.height+"px",this.__wrapElement(r,t),t.data("wrapper",r));var s=this.tryLoadImage(t,document.body.scrollTop+n-this.options.threshold),l=this.__debounce(function(){this.tryLoadImage(t,document.body.scrollTop+n-this.options.threshold)&&window.removeEventListener("scroll",l)}.bind(this),50);s||window.addEventListener("scroll",l)}},{key:"tryLoadImage",value:function(e,t){var n=void 0;return!(e.getBoundingClientRect().top>t)&&(n="IMG"!==e.nodeName?"background":e.getAttribute("data-srcset")?"srcset":"src",e.data("type",$type),this.__loadImageByType(e,n),!0)}},{key:"__debounce",value:function(e,t,n){var o=void 0;return function(){var a=this,i=arguments,r=n&&!o;clearTimeout(o),o=setTimeout(function(){o=null,n||e.apply(a,i)},t),r&&e.apply(a,i)}}},{key:"__wrapElement",value:function(e,t){t.length||(t=[t]);for(var n=t.length-1;n>=0;n--){var o=n>0?e.cloneNode(!0):e,a=t[n],i=a.parentNode,r=a.nextSibling;o.appendChild(a),r?i.insertBefore(o,r):i.appendChild(o)}}},{key:"__getImageDimensions",value:function(e){var t=window.getComputedStyle(e),n="IMG"===e.nodeName?Number(e.getAttribute("width")):e.offsetWidth,o="IMG"===e.nodeName?Number(e.getAttribute("height")):e.offsetHeight,a="none"===t.getPropertyValue("max-width")?null:t.getPropertyValue("max-width"),i=n/o;if(a){if(a.indexOf("%")>-1){var r=Number(a.replace("%",""))/100,s=window.getComputedStyle(e.parentElement).getPropertyValue("width");a=Number(s.replace("px",""))*r}else a.indexOf("px")>-1&&(a=Number(a.replace("px","")));Number(n)>Number(a)&&(n=a,o=a/i)}else a=n;return{width:n,height:o,maxWidth:a,aspectRatio:i}}},{key:"__attachLoadEvent",value:function(e,t,n){function o(){e.parentElement.classList.add("is-loaded"),n&&t.classList.add("is-loaded")}if("IMG"!==e.nodeName){t=t||e.data("wrapper"),n=n||e.data("shouldWrap");var a=window.getComputedStyle(e).getPropertyValue("background-image").replace(/(?:^url\(["']?)|(?:["']?\))$/g,""),i=new Image;i.onload=o.bind(this),i.src=a,i.complete&&i.onload()}else e.onload=o.bind(this)}},{key:"__loadImageByType",value:function(e,t){switch(__attachLoadEvent(e),t){case"srcset":e.srcset=e.getAttribute("data-srcset"),e.src=e.getAttribute("data-src");break;case"background":this.options.backgroundClass?e.classList.remove(this.options.backgroundClass.replace(/^\./,"")):e.style.removeProperty("background");break;default:e.src=e.getAttribute("data-src")}}}]),a}();if(window.jQuery){var i=window.jQuery;i.fn[e]=function(t){return t=t||{},this.each(function(){i.data(this,"plugin_"+e)||(t.element=this,i.data(this,"plugin_"+e,new a(this,t)))})}}return a});