"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){"function"==typeof define&&define.amd?define([],e("lousyLoad")):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=e("lousyLoad"):t.lousyLoad=e("lousyLoad")}(window,function(t){var e={immediate:!0,selector:"img",threshold:100,wrapElement:!0},i=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n]);for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(i[o]=e[o]);return i};window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(t,e){e=e||window;for(var i=0;i<this.length;i++)t.call(e,this[i],i,this)});var n=function(){function n(o,r){_classCallCheck(this,n),this.utils={debounce:function(t,e,i){var n=void 0;return function(){var o=this,r=arguments,a=i&&!n;clearTimeout(n),n=setTimeout(function(){n=null,i||t.apply(o,r)},e),a&&t.apply(o,r)}},wrapElement:function(t,e){e.length||(e=[e]);for(var i=e.length-1;i>=0;i--){var n=i>0?t.cloneNode(!0):t,o=e[i],r=o.parentNode,a=o.nextSibling;n.appendChild(o),a?r.insertBefore(n,a):r.appendChild(n)}}},this.element=o,this._defaults=e,this._name=t,this.options=i(e,r),this.options.immediate&&this.init()}return _createClass(n,[{key:"init",value:function(){var t=this.element.querySelectorAll(this.options.selector);return t.forEach(this.prepareImage.bind(this)),t}},{key:"prepareImage",value:function(t){var e=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=function(t){var e=window.getComputedStyle(t).getPropertyValue("max-width"),i=t.getAttribute("width"),n=t.getAttribute("height"),o=i/n;if(e){if(e.indexOf("%")>-1){var r=Number(e.replace("%",""))/100,a=window.getComputedStyle(t.parentElement).getPropertyValue("width");e=Number(a.replace("px",""))*r}else e.indexOf("px")>-1&&(e=e.replace("px",""));Number(i)>Number(e)&&(i=e,n=e/o)}return{width:i,height:n,maxWidth:e,aspectRatio:o}}(t),n=void 0;this.options.wrapElement&&((n=document.createElement("span")).classList.add("ll-image_wrapper"),n.style.width=i.width+"px",n.style.height=i.height+"px",n.style.display="inline-block",t.classList.add("ll-image"),t.style.width=i.width+"px",t.style.height=i.height+"px",this.utils.wrapElement(n,t)),t.onload=function(){t.parentElement.classList.add("is-loaded"),this.options.wrapElement&&n.classList.add("is-loaded")}.bind(this);var o=this.tryLoadImage(t,document.body.scrollTop+e-this.options.threshold),r=this.utils.debounce(function(){this.tryLoadImage(t,document.body.scrollTop+e-this.options.threshold)&&window.removeEventListener("scroll",r)}.bind(this),50);o||window.addEventListener("scroll",r)}},{key:"tryLoadImage",value:function(t,e){var i=void 0;return!t.getAttribute("data-src")||!(t.offsetTop>e)&&(i=t.getAttribute("data-srcset")?"srcset":"src",this.__loadImageByType(t,i),!0)}},{key:"__loadImageByType",value:function(t,e){switch(e){case"srcset":t.srcset=t.getAttribute("data-srcset"),t.src=t.getAttribute("data-src");break;default:t.src=t.getAttribute("data-src")}}}]),n}();if(window.jQuery){var o=window.jQuery;o.fn[t]=function(e){return e=e||{},this.each(function(){o.data(this,"plugin_"+t)||(e.element=this,o.data(this,"plugin_"+t,new n(this,e)))})}}return n});